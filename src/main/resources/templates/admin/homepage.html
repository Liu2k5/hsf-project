<!DOCTYPE html>
<html lang="vi" xmlns:th="https://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title th:replace="~{fragments/header :: title}">B·∫£ng ƒëi·ªÅu khi·ªÉn Qu·∫£n tr·ªã</title>
    <th:block th:replace="~{fragments/styles :: styles}"></th:block>
</head>
<body>
<div th:replace="~{fragments/header :: header('B·∫£ng ƒëi·ªÅu khi·ªÉn Qu·∫£n tr·ªã')}"></div>

<div class="container">
    <!-- Navigation Tabs -->
    <div class="nav-tabs">
        <button class="nav-tab active" onclick="switchTab('dashboard', event)">üìä T·ªïng quan</button>
        <button class="nav-tab" onclick="switchTab('users', event)">üë• Ng∆∞·ªùi d√πng</button>
        <button class="nav-tab" onclick="switchTab('orders', event)">üì¶ ƒê∆°n h√†ng</button>
        <button class="nav-tab" onclick="switchTab('licenses', event)">üîë Gi·∫•y ph√©p</button>
        <button class="nav-tab" onclick="switchTab('products', event)">üì¶ S·∫£n ph·∫©m</button>
    </div>

    <!-- Dashboard Tab -->
    <div id="dashboard-tab" class="tab-content active">
        <div class="stats-grid">
            <div class="stat-card">
                <h3>T·ªïng doanh thu</h3>
                <div class="value" id="total-revenue">‚Ç´0</div>
            </div>
            <div class="stat-card">
                <h3>ƒê∆°n h√†ng m·ªõi h√¥m nay</h3>
                <div class="value" id="new-orders-today">0</div>
            </div>
            <div class="stat-card">
                <h3>Phi√™n ho·∫°t ƒë·ªông</h3>
                <div class="value" id="active-sessions">0</div>
            </div>
        </div>

        <div class="card">
            <div class="card-header">
                <h2>üìà Bi·ªÉu ƒë·ªì doanh thu</h2>
            </div>
            <div class="chart-container">
                <canvas id="revenue-chart"></canvas>
            </div>
        </div>

        <div class="card">
            <div class="card-header">
                <h2>üèÜ S·∫£n ph·∫©m b√°n ch·∫°y</h2>
            </div>
            <ul class="products-list" id="top-products">
                <li class="loading">ƒêang t·∫£i...</li>
            </ul>
        </div>
    </div>

    <!-- Users Tab -->
    <div id="users-tab" class="tab-content">
        <div class="card">
            <div class="card-header">
                <h2>Qu·∫£n l√Ω ng∆∞·ªùi d√πng</h2>
                <button class="btn btn-primary" onclick="openAddUser()">+ Th√™m ng∆∞·ªùi d√πng</button>
            </div>
            <div id="users-error" class="error" style="display: none;"></div>
            <table>
                <thead>
                <tr>
                    <th>ID</th>
                    <th>T√™n ƒëƒÉng nh·∫≠p</th>
                    <th>Vai tr√≤</th>
                    <th>H√†nh ƒë·ªông</th>
                </tr>
                </thead>
                <tbody id="users-table">
                <tr>
                    <td colspan="4" class="loading">ƒêang t·∫£i...</td>
                </tr>
                </tbody>
            </table>
            <div class="pagination" id="users-pagination"></div>
        </div>
    </div>

    <!-- Orders Tab -->
    <div id="orders-tab" class="tab-content">
        <div class="card">
            <div class="card-header">
                <h2>Qu·∫£n l√Ω ƒë∆°n h√†ng</h2>
            </div>
            <div class="filter-group">
                <select id="order-status-filter" class="select-input" onchange="loadOrders(0)">
                    <option value="">T·∫•t c·∫£ tr·∫°ng th√°i</option>
                    <option value="PENDING">ƒêang ch·ªù</option>
                    <option value="COMPLETED">Ho√†n th√†nh</option>
                    <option value="CANCELLED">ƒê√£ h·ªßy</option>
                </select>
                <input type="date" id="order-date-filter" class="select-input" onchange="loadOrders(0)">
            </div>
            <div id="orders-error" class="error" style="display: none;"></div>
            <table>
                <thead>
                <tr>
                    <th>ID</th>
                    <th>Ng∆∞·ªùi d√πng</th>
                    <th>S·∫£n ph·∫©m</th>
                    <th>Ng√†y thanh to√°n</th>
                    <th>Tr·∫°ng th√°i</th>
                    <th>H√†nh ƒë·ªông</th>
                </tr>
                </thead>
                <tbody id="orders-table">
                <tr>
                    <td colspan="6" class="loading">ƒêang t·∫£i...</td>
                </tr>
                </tbody>
            </table>
            <div class="pagination" id="orders-pagination"></div>
        </div>
    </div>

    <!-- Licenses Tab -->
    <div id="licenses-tab" class="tab-content">
        <div class="card">
            <div class="card-header">
                <h2>Qu·∫£n l√Ω gi·∫•y ph√©p</h2>
                <input type="text" id="license-search" class="search-input"
                       placeholder="T√¨m ki·∫øm theo key, ng∆∞·ªùi d√πng ho·∫∑c s·∫£n ph·∫©m..."
                       onkeyup="searchLicenses()">
            </div>
            <div id="licenses-error" class="error" style="display: none;"></div>
            <table>
                <thead>
                <tr>
                    <th>ID</th>
                    <th>License Key</th>
                    <th>Ng∆∞·ªùi d√πng</th>
                    <th>S·∫£n ph·∫©m</th>
                    <th>Tr·∫°ng th√°i</th>
                    <th>H√†nh ƒë·ªông</th>
                </tr>
                </thead>
                <tbody id="licenses-table">
                <tr>
                    <td colspan="6" class="loading">ƒêang t·∫£i...</td>
                </tr>
                </tbody>
            </table>
            <div class="pagination" id="licenses-pagination"></div>
        </div>
    </div>

    <!-- Products Tab -->
    <div id="products-tab" class="tab-content">
        <div class="card">
            <div class="card-header">
                <h2>Qu·∫£n l√Ω s·∫£n ph·∫©m</h2>
                <button class="btn btn-primary" onclick="openAddProduct()">+ Th√™m s·∫£n ph·∫©m</button>
            </div>
            <div id="products-error" class="error" style="display: none;"></div>
            <table>
                <thead>
                <tr>
                    <th>ID</th>
                    <th>T√™n s·∫£n ph·∫©m</th>
                    <th>Gi√°</th>
                    <th>S·ªë l∆∞·ª£ng</th>
                    <th>H√†nh ƒë·ªông</th>
                </tr>
                </thead>
                <tbody id="products-table">
                <tr>
                    <td colspan="5" class="loading">ƒêang t·∫£i...</td>
                </tr>
                </tbody>
            </table>
        </div>
    </div>
</div>

<!-- Update Role Modal -->
<div id="role-modal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h3>C·∫≠p nh·∫≠t vai tr√≤</h3>
        </div>
        <div class="form-group">
            <label>T√™n ƒëƒÉng nh·∫≠p:</label>
            <input type="text" id="role-username" class="form-control" readonly>
        </div>
        <div class="form-group">
            <label>Vai tr√≤ m·ªõi:</label>
            <select id="role-select" class="form-control">
                <option value="ROLE_CUSTOMER">CUSTOMER</option>
                <option value="ROLE_ADMIN">ADMIN</option>
            </select>
        </div>
        <div class="modal-actions">
            <button class="btn" onclick="closeModal('role-modal')">H·ªßy</button>
            <button class="btn btn-primary" onclick="updateRole()">C·∫≠p nh·∫≠t</button>
        </div>
    </div>
</div>

<!-- Add User Modal -->
<div id="add-user-modal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h3>Th√™m ng∆∞·ªùi d√πng</h3>
        </div>
        <div class="form-group">
            <label for="add-username">T√™n ƒëƒÉng nh·∫≠p: <span style="color: red;">*</span></label>
            <input type="text" id="add-username" class="form-control"
                   placeholder="Nh·∫≠p t√™n ƒëƒÉng nh·∫≠p (t·ªëi thi·ªÉu 3 k√Ω t·ª±)"
                   minlength="3" required>
        </div>
        <div class="form-group">
            <label for="add-password">M·∫≠t kh·∫©u: <span style="color: red;">*</span></label>
            <input type="password" id="add-password" class="form-control"
                   placeholder="Nh·∫≠p m·∫≠t kh·∫©u (t·ªëi thi·ªÉu 6 k√Ω t·ª±)"
                   minlength="6" required>
        </div>
        <div class="form-group">
            <label for="add-email">Email: <span style="color: red;">*</span></label>
            <input type="email" id="add-email" class="form-control"
                   placeholder="Nh·∫≠p ƒë·ªãa ch·ªâ email"
                   required>
        </div>
        <div class="form-group">
            <label for="add-role">Vai tr√≤: <span style="color: red;">*</span></label>
            <select id="add-role" class="form-control" required>
                <option value="ROLE_CUSTOMER">CUSTOMER</option>
                <option value="ROLE_ADMIN">ADMIN</option>
            </select>
        </div>
        <div class="modal-actions">
            <button class="btn" onclick="closeModal('add-user-modal')">H·ªßy</button>
            <button class="btn btn-primary" onclick="addUser()">Th√™m</button>
        </div>
    </div>
</div>

<!-- Revoke License Modal -->
<div id="revoke-modal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h3>Thu h·ªìi gi·∫•y ph√©p</h3>
        </div>
        <div class="form-group">
            <label>License Key:</label>
            <input type="text" id="revoke-key" class="form-control" readonly>
        </div>
        <div class="form-group">
            <label>L√Ω do thu h·ªìi:</label>
            <textarea id="revoke-reason" class="form-control" rows="3"
                      placeholder="Nh·∫≠p l√Ω do thu h·ªìi..."></textarea>
        </div>
        <div class="modal-actions">
            <button class="btn" onclick="closeModal('revoke-modal')">H·ªßy</button>
            <button class="btn btn-danger" onclick="revokeLicense()">Thu h·ªìi</button>
        </div>
    </div>
</div>

<!-- Order Details Modal -->
<div id="order-modal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h3>Chi ti·∫øt ƒë∆°n h√†ng</h3>
        </div>
        <div id="order-details">
            <div class="loading">ƒêang t·∫£i...</div>
        </div>
        <div class="modal-actions">
            <button class="btn" onclick="closeModal('order-modal')">ƒê√≥ng</button>
        </div>
    </div>
</div>

<!-- Add Product Modal -->
<div id="product-modal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h3 id="product-modal-title">Th√™m s·∫£n ph·∫©m</h3>
        </div>
        <div class="form-group">
            <label>T√™n s·∫£n ph·∫©m:</label>
            <input type="text" id="product-name" class="form-control" placeholder="Nh·∫≠p t√™n s·∫£n ph·∫©m">
        </div>
        <div class="form-group">
            <label>M√¥ t·∫£:</label>
            <textarea id="product-description" class="form-control" rows="3" placeholder="Nh·∫≠p m√¥ t·∫£ s·∫£n ph·∫©m"></textarea>
        </div>
        <div class="form-group">
            <label>Gi√° (VND):</label>
            <input type="number" id="product-price" class="form-control" placeholder="Nh·∫≠p gi√°">
        </div>
        <div class="form-group">
            <label>S·ªë l∆∞·ª£ng:</label>
            <input type="number" id="product-quantity" class="form-control" placeholder="Nh·∫≠p s·ªë l∆∞·ª£ng">
        </div>
        <div class="form-group">
            <label>URL h√¨nh ·∫£nh:</label>
            <input type="url" id="product-image-url" class="form-control" placeholder="https://example.com/image.jpg" oninput="previewProductImage()">
            <small style="color: #666; display: block; margin-top: 5px;">
                Nh·∫≠p URL ƒë·∫ßy ƒë·ªß (b·∫Øt ƒë·∫ßu b·∫±ng http:// ho·∫∑c https://). H·ªó tr·ª£ c√°c ƒë·ªãnh d·∫°ng: JPG, PNG, GIF, WebP, BMP, SVG
            </small>
        </div>
        <div class="form-group" id="image-preview-container" style="display: none;">
            <label>Xem tr∆∞·ªõc:</label>
            <div style="border: 1px solid #ddd; padding: 10px; border-radius: 4px; text-align: center; background: #f9f9f9;">
                <img id="product-image-preview" src="" alt="Xem tr∆∞·ªõc h√¨nh ·∫£nh" style="max-width: 100%; max-height: 200px; display: none;" onload="this.style.display='block'; hideImageMessages()" onerror="showImageError()">
                <div id="image-error-message" style="display: none; color: #e74c3c; padding: 10px;">
                    ‚ùå Kh√¥ng th·ªÉ t·∫£i h√¨nh ·∫£nh. Vui l√≤ng ki·ªÉm tra:
                    <ul style="text-align: left; margin: 5px 0; padding-left: 20px;">
                        <li>URL c√≥ ƒë√∫ng ƒë·ªãnh d·∫°ng kh√¥ng (b·∫Øt ƒë·∫ßu b·∫±ng http:// ho·∫∑c https://)</li>
                        <li>H√¨nh ·∫£nh c√≥ t·ªìn t·∫°i v√† c√≥ th·ªÉ truy c·∫≠p c√¥ng khai kh√¥ng</li>
                        <li>ƒê·ªãnh d·∫°ng file c√≥ ƒë∆∞·ª£c h·ªó tr·ª£ kh√¥ng (JPG, PNG, GIF, WebP)</li>
                    </ul>
                </div>
                <div id="image-loading-message" style="color: #666; padding: 10px;">‚è≥ ƒêang t·∫£i h√¨nh ·∫£nh...</div>
            </div>
        </div>
        <div class="modal-actions">
            <button class="btn" onclick="closeModal('product-modal')">H·ªßy</button>
            <button class="btn btn-primary" onclick="saveProduct()">L∆∞u</button>
        </div>
    </div>
</div>

<div th:replace="~{fragments/footer :: footer}"></div>

<th:block th:replace="~{fragments/header :: header-script}"></th:block>
<th:block th:replace="~{fragments/scripts :: scripts}"></th:block>
</body>
</html>